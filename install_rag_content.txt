<#
.SYNOPSIS
    Installation script for Antigravity RAG Services.
    Can be used to set up the environment on a new machine.

.DESCRIPTION
    This script:
    1. Checks for Python installation.
    2. install dependencies from requirements.txt.
    3. Creates necessary directories.
    4. Provides MCP configuration snippet.

.EXAMPLE
    .\install_rag.ps1
#>

$ErrorActionPreference = "Stop"
# Fix encoding for Cyrillic
[Console]::OutputEncoding = [System.Text.Encoding]::UTF8

Write-Host "üì¶ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏ –ø–∞–º'—è—Ç—ñ Antigravity RAG..." -ForegroundColor Cyan

# 1. Check Python
try {
    $pyVersion = python --version 2>&1
    Write-Host "   ‚úÖ Python –∑–Ω–∞–π–¥–µ–Ω–æ: $pyVersion" -ForegroundColor Green
}
catch {
    Write-Host "   ‚ùå Python –ù–ï –∑–Ω–∞–π–¥–µ–Ω–æ. –ë—É–¥—å –ª–∞—Å–∫–∞, –≤—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å Python 3.10+ —Ç–∞ –¥–æ–¥–∞–π—Ç–µ –¥–æ PATH." -ForegroundColor Red
    Exit 1
}

# 2. Install Dependencies
$reqFile = Join-Path $PSScriptRoot "requirements.txt"
if (Test-Path $reqFile) {
    Write-Host "   ‚¨áÔ∏è  –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π..." -ForegroundColor Cyan
    pip install -r $reqFile
}
else {
    Write-Host "   ‚ö†Ô∏è  requirements.txt –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ!" -ForegroundColor Yellow
}

# 3. Create Directories
$ragDbDir = "$env:USERPROFILE\.gemini\antigravity\.rag\chroma_db"
if (-not (Test-Path $ragDbDir)) {
    New-Item -ItemType Directory -Force -Path $ragDbDir | Out-Null
    Write-Host "   ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é –±–∞–∑–∏ –¥–∞–Ω–∏—Ö: $ragDbDir" -ForegroundColor Green
}

# 4. Generate MCP Config Snippet
$ragServerPath = Join-Path $PSScriptRoot "server.py"
$ragServerPath = $ragServerPath -replace "\\", "/"  # JSON friendly

Write-Host ""
Write-Host "üéâ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ!" -ForegroundColor Cyan
Write-Host ""
Write-Host "üëâ –ù–ï–û–ë–•–Ü–î–ù–ê –î–Ü–Ø: –î–æ–¥–∞–π—Ç–µ —Ü–µ –¥–æ –≤–∞—à–æ–≥–æ mcp_config.json:" -ForegroundColor Yellow
Write-Host ""
Write-Host """antigravity-rag"": {"
Write-Host "  ""command"": ""python"","
Write-Host "  ""args"": [""$ragServerPath""]"
Write-Host "}"
Write-Host ""
Write-Host "üöÄ –î–ª—è –∑–∞–ø—É—Å–∫—É —Å–µ—Ä–≤—ñ—Å—ñ–≤ –≤–∏–∫–æ–Ω–∞–π—Ç–µ: .\start_rag_services.ps1" -ForegroundColor Green
